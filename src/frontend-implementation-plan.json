{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix user registration check during ICP purchase",
  "requirements": [
    {
      "id": "REQ-2",
      "summary": "Fix the frontend trading panel to correctly handle registration check responses and display appropriate error messages only when a user is genuinely not registered",
      "acceptanceCriteria": [
        "The trading panel's buy ICP action properly parses backend registration errors",
        "Users who have completed registration see no 'user not registered' errors when attempting to buy ICP",
        "Clear error messages are shown only for genuinely unregistered users"
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useTradingActions.ts",
          "operation": "modify",
          "description": "Update the buyICP mutation error handling logic to correctly parse and distinguish between genuine 'user not registered' errors and other backend errors. Ensure the error parser checks for account existence via getOrCreateAccount before showing registration errors, and improve error message parsing to avoid false positives for registered users."
        },
        {
          "path": "frontend/src/components/TradingPanel.tsx",
          "operation": "modify",
          "description": "Enhance error handling in the buy ICP flow to display user-friendly error messages based on the parsed error type. Ensure that registration-related errors are only shown when the backend confirms the user is not registered, and add fallback messaging for unexpected errors."
        }
      ]
    }
  ]
}