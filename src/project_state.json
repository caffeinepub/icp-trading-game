{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 19,
  "summary": "ICP trading simulator game with real-time price charts (24h/7d/30d/90d/180d), multiple game modes (24-hour, 7-day, 30-day, 1-year) with automatic resets and winner tracking, $10,000 virtual trading accounts per game mode, buy/sell mechanics with dollar or ICP amount input, leaderboards showing top performers for each game mode, leveraged trading with multiple leverage levels (2x, 3x, 5x, 10x, 20x) for long/short positions, margin call statistics displayed on charts, and candlestick chart visualization",
  "architectural_notes": [
    "Store player virtual balances and transaction history in backend canister",
    "Calculate profit/loss based on difference between starting $10,000 and current portfolio value",
    "Implement admin-only access control for reset functionality (restrict to specific principal or role)",
    "Support multiple concurrent game modes with independent player accounts and balances per mode",
    "Implement countdown timers for each game mode (24h, 7d, 30d, 1yr) with automatic reset on expiration",
    "Store winner history per game mode to display past champions after each reset cycle",
    "Support multiple leverage levels (2x, 3x, 5x, 10x, 20x) for leveraged positions",
    "Display margin call levels and liquidation prices on price charts",
    "Replace CoinGecko API integration with Kong Swap API for real-time ICP price and OHLC data",
    "Switch from candlestick chart to line chart for better visualization accuracy with Kong Swap data"
  ],
  "known_issues": [
    "Buy transactions do not deduct virtual cash from player's $10,000 balance",
    "ICP purchase calculations may be inaccurate or glitching",
    "Candlestick chart display is incorrect and not rendering Kong Swap data properly"
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-display-an-interactive-icp-price-chart-on-the-frontend-with-toggleable-timeframe-views-24h-7d-30d-90d-180d-showing-historical-price-movements",
      "title": "Display an interactive ICP price chart on the frontend with toggleable timeframe views (24h, 7d, 30d, 90d, 180d) showing historical price movements",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-buy-and-sell-functionality-allowing-players-to-purchase-and-sell-virtual-icp-tokens-using-their-10-000-virtual-cash-balance-at-current-real-world-icp-prices",
      "title": "Implement buy and sell functionality allowing players to purchase and sell virtual ICP tokens using their $10,000 virtual cash balance at current real-world ICP prices",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-portfolio-view-showing-the-authenticated-player-s-current-virtual-cash-balance-virtual-icp-holdings-and-total-portfolio-value-in-real-time",
      "title": "Create a portfolio view showing the authenticated player's current virtual cash balance, virtual ICP holdings, and total portfolio value in real-time",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-weekly-leaderboard-that-calculates-each-player-s-profit-or-loss-at-the-end-of-each-week-and-ranks-players-from-highest-to-lowest-gains",
      "title": "Build a weekly leaderboard that calculates each player's profit or loss at the end of each week and ranks players from highest to lowest gains",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-design-a-cohesive-visual-theme-for-the-trading-game-interface-with-a-financial-trading-aesthetic-using-colors-and-typography-that-convey-professionalism-and-clarity-avoiding-blue-and-purple-unless-specifically-requested",
      "title": "Design a cohesive visual theme for the trading game interface with a financial/trading aesthetic using colors and typography that convey professionalism and clarity, avoiding blue and purple unless specifically requested",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-trading-panel-to-display-error-messages-when-transactions-fail-due-to-insufficient-funds-or-insufficient-icp-holdings",
      "title": "Update the frontend trading panel to display error messages when transactions fail due to insufficient funds or insufficient ICP holdings",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-admin-only-reset-button-to-the-portfolio-view-that-resets-the-authenticated-player-s-cash-balance-to-10-000-and-clears-all-icp-holdings-to-zero",
      "title": "Add an admin-only reset button to the portfolio view that resets the authenticated player's cash balance to $10,000 and clears all ICP holdings to zero",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-frontend-usetradingactions-hook-function-resetaccount-that-calls-the-backend-reset-account-function-and-invalidates-portfolio-queries-on-success",
      "title": "Create a frontend useTradingActions hook function resetAccount that calls the backend reset_account function and invalidates portfolio queries on success",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-toggle-or-tab-to-the-tradingpanel-buy-interface-allowing-users-to-switch-between-purchasing-icp-by-specifying-an-icp-amount-or-by-specifying-a-dollar-amount-e-g-10-000-automatically-calculating-the-equivalent-icp-quantity-using-the-current-icp-price",
      "title": "Add a toggle or tab to the TradingPanel buy interface allowing users to switch between purchasing ICP by specifying an ICP amount or by specifying a dollar amount (e.g., $10,000), automatically calculating the equivalent ICP quantity using the current ICP price",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-game-mode-selector-to-the-frontend-that-allows-users-to-switch-between-24-hour-7-day-30-day-and-1-year-game-modes-updating-the-portfolio-trading-panel-and-leaderboard-to-display-data-specific-to-the-selected-mode",
      "title": "Add a game mode selector to the frontend that allows users to switch between 24-hour, 7-day, 30-day, and 1-year game modes, updating the portfolio, trading panel, and leaderboard to display data specific to the selected mode",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-display-a-countdown-timer-in-the-frontend-showing-time-remaining-until-the-next-reset-for-the-currently-selected-game-mode-24h-7d-30d-or-1y",
      "title": "Display a countdown timer in the frontend showing time remaining until the next reset for the currently selected game mode (24h, 7d, 30d, or 1y)",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-historical-winners-section-to-the-leaderboard-view-that-displays-past-winners-for-the-selected-game-mode-showing-their-final-portfolio-values-and-profit-loss-percentages-from-previous-reset-periods",
      "title": "Add a historical winners section to the leaderboard view that displays past winners for the selected game mode, showing their final portfolio values and profit/loss percentages from previous reset periods",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-display-the-user-s-current-icp-holdings-amount-in-the-sell-section-of-the-tradingpanel-showing-how-much-icp-is-available-to-sell",
      "title": "Display the user's current ICP holdings amount in the sell section of the TradingPanel, showing how much ICP is available to sell",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-max-button-to-the-sell-interface-that-auto-fills-the-input-field-with-the-user-s-full-icp-holdings-allowing-them-to-sell-all-their-icp-with-one-click",
      "title": "Add a MAX button to the sell interface that auto-fills the input field with the user's full ICP holdings, allowing them to sell all their ICP with one click",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-max-button-to-the-buy-interface-that-auto-fills-the-input-with-either-the-maximum-icp-purchasable-with-available-cash-when-in-icp-mode-or-the-full-cash-balance-when-in-dollar-mode",
      "title": "Add a MAX button to the buy interface that auto-fills the input with either the maximum ICP purchasable with available cash (when in ICP mode) or the full cash balance (when in dollar mode)",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-frontend-positions-component-that-displays-all-active-leveraged-positions-in-a-table-showing-position-type-leverage-2x-entry-price-current-price-amount-unrealized-p-l-and-a-close-button-for-each-position",
      "title": "Create a frontend Positions component that displays all active leveraged positions in a table showing position type, leverage (2x), entry price, current price, amount, unrealized P&L, and a close button for each position",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-leverage-tab-to-the-tradingpanel-component-with-controls-to-open-long-or-short-positions-at-2x-leverage-showing-required-margin-position-size-and-validation-for-sufficient-cash",
      "title": "Add a Leverage tab to the TradingPanel component with controls to open long or short positions at 2x leverage, showing required margin, position size, and validation for sufficient cash",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-portfolio-component-to-include-leveraged-positions-value-in-total-portfolio-calculation-showing-total-margin-locked-and-total-unrealized-p-l-separately",
      "title": "Update the Portfolio component to include leveraged positions value in total portfolio calculation, showing total margin locked and total unrealized P&L separately",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-create-custom-hooks-usepositions-and-useleverageactions-for-fetching-active-positions-and-executing-open-close-position-actions-with-query-invalidation",
      "title": "Create custom hooks usePositions and useLeverageActions for fetching active positions and executing open/close position actions with query invalidation",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-update-leaderboard-calculations-to-include-unrealized-p-l-from-leveraged-positions-in-each-player-s-total-portfolio-value-for-ranking-purposes",
      "title": "Update leaderboard calculations to include unrealized P&L from leveraged positions in each player's total portfolio value for ranking purposes",
      "reqIds": [
        "REQ-35"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-leverage-tab-in-tradingpanel-to-include-a-leverage-selector-allowing-users-to-choose-between-2x-3x-5x-10x-and-20x-leverage-before-opening-long-or-short-positions",
      "title": "Update the frontend Leverage tab in TradingPanel to include a leverage selector allowing users to choose between 2x, 3x, 5x, 10x, and 20x leverage before opening long or short positions",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-positions-component-to-display-the-leverage-multiplier-for-each-active-position-in-the-table",
      "title": "Update the Positions component to display the leverage multiplier for each active position in the table",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-add-margin-statistics-overlay-to-the-pricechart-component-showing-total-margin-used-available-margin-remaining-cash-margin-usage-percentage-and-nearest-liquidation-price-for-active-positions",
      "title": "Add margin statistics overlay to the PriceChart component showing total margin used, available margin (remaining cash), margin usage percentage, and nearest liquidation price for active positions",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-calculate-and-display-liquidation-prices-for-leveraged-positions-on-the-chart-indicating-the-price-level-at-which-each-position-would-be-liquidated-based-on-its-leverage-and-entry-price",
      "title": "Calculate and display liquidation prices for leveraged positions on the chart, indicating the price level at which each position would be liquidated based on its leverage and entry price",
      "reqIds": [
        "REQ-40"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-line-chart-in-pricechart-component-with-a-candlestick-chart-showing-ohlc-open-high-low-close-data-for-icp-price-movements",
      "title": "Replace the line chart in PriceChart component with a candlestick chart showing OHLC (Open, High, Low, Close) data for ICP price movements",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-useicppricedata-hook-to-fetch-ohlc-candlestick-data-from-the-coingecko-api-instead-of-simple-price-points-providing-open-high-low-and-close-values-for-each-time-interval",
      "title": "Update the useICPPriceData hook to fetch OHLC candlestick data from the CoinGecko API instead of simple price points, providing open, high, low, and close values for each time interval",
      "reqIds": [
        "REQ-42"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-all-coingecko-api-integration-from-the-frontend-useicppricedata-hook-frontend-src-hooks-useicppricedata-ts-including-getcurrentprice-and-gethistoricaldata-functions-that-fetch-from-coingecko-endpoints",
      "title": "Remove all CoinGecko API integration from the frontend useICPPriceData hook (frontend/src/hooks/useICPPriceData.ts), including getCurrentPrice and getHistoricalData functions that fetch from CoinGecko endpoints",
      "reqIds": [
        "REQ-43"
      ],
      "version": 1
    },
    {
      "id": "feature-integrate-kong-swap-api-in-the-useicppricedata-hook-to-fetch-current-icp-price-and-ohlc-candlestick-data-for-the-supported-timeframes-24h-7d-30d-90d-180d-using-kong-swap-s-dex-trading-data-endpoints",
      "title": "Integrate Kong Swap API in the useICPPriceData hook to fetch current ICP price and OHLC candlestick data for the supported timeframes (24h, 7d, 30d, 90d, 180d), using Kong Swap's DEX trading data endpoints",
      "reqIds": [
        "REQ-44"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-candlestick-chart-in-pricechart-component-frontend-src-components-pricechart-tsx-with-a-simple-line-chart-visualization-using-kong-swap-api-price-data",
      "title": "Replace the candlestick chart in PriceChart component (frontend/src/components/PriceChart.tsx) with a simple line chart visualization using Kong Swap API price data",
      "reqIds": [
        "REQ-47"
      ],
      "version": 1
    },
    {
      "id": "feature-update-useicppricedata-hook-frontend-src-hooks-useicppricedata-ts-to-fetch-simple-price-points-from-kong-swap-api-instead-of-ohlc-candlestick-data-for-line-chart-visualization",
      "title": "Update useICPPriceData hook (frontend/src/hooks/useICPPriceData.ts) to fetch simple price points from Kong Swap API instead of OHLC candlestick data for line chart visualization",
      "reqIds": [
        "REQ-48"
      ],
      "version": 1
    },
    {
      "id": "feature-integrate-all-available-trading-tools-and-metrics-from-kong-swap-api-into-the-frontend-including-trading-volume-indicators-liquidity-metrics-order-book-depth-and-any-technical-analysis-tools-provided-by-kong-swap",
      "title": "Integrate all available trading tools and metrics from Kong Swap API into the frontend, including trading volume indicators, liquidity metrics, order book depth, and any technical analysis tools provided by Kong Swap",
      "reqIds": [
        "REQ-49"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Display ICP price chart with 24h/7d/30d/90d/180d timeframes using CoinGecko API",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Weekly $10,000 virtual trading account per player with buy/sell ICP functionality",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Weekly leaderboard showing players ranked by profit/loss",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Future: Add leverage trading (long/short positions)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Integrate CoinGecko API to fetch real-time ICP price data with support for multiple timeframes: 24 hour, 7 day, 30 day, 90 day, and 180 day historical data",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Create a weekly trading account system where each authenticated player receives $10,000 in virtual currency at the start of each week",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Modify the backend buy_icp function to deduct the total purchase cost (ICP amount × current price) from the player's cash balance before adding the ICP to their holdings",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Modify the backend sell_icp function to add the total sale proceeds (ICP amount × current price) to the player's cash balance after deducting the ICP from their holdings",
      "reqIds": [
        "REQ-9"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Add validation to prevent buy transactions when the total cost exceeds the player's available cash balance",
      "reqIds": [
        "REQ-10"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Add validation to prevent sell transactions when the ICP amount exceeds the player's available ICP holdings",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Add admin-only button to reset player's cash balance to $10,000 and clear all ICP holdings",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Fix calculation glitch in ICP purchase transactions to ensure accurate deduction and holding amounts",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Review and fix the ICP purchase calculation logic in the backend buy_icp function to ensure accurate deduction of cash and addition of ICP holdings, eliminating any calculation glitches",
      "reqIds": [
        "REQ-14"
      ],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Add a backend function reset_account that resets a player's cash balance to 10000.0 and icp_balance to 0.0, with admin authorization check",
      "reqIds": [
        "REQ-15"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Add toggle to purchase ICP using dollar amount input (e.g., $10,000) instead of ICP amount, automatically calculating equivalent ICP",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Implement multiple game modes: 24-hour, 7-day, 30-day, and 1-year, each with independent accounts and automatic reset timers",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Track and display historical winners for each game mode (24h, 7d, 30d, 1yr) after each reset period",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Implement four independent game modes in the backend: 24-hour, 7-day, 30-day, and 1-year, each with separate player accounts (cash balance and ICP holdings), isolated leaderboards, and automatic reset timers that trigger at the end of each period",
      "reqIds": [
        "REQ-18"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Store historical winners for each game mode in the backend, capturing the top-performing player(s) at the end of each reset period (24h, 7d, 30d, 1y) along with their final portfolio value and profit/loss",
      "reqIds": [
        "REQ-19"
      ],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Display current ICP balance on the sell interface and add a MAX button that auto-fills the input with the player's full ICP holdings for selling or full cash balance for buying",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Add basic 2x leveraged trading with long and short positions",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Add backend data structures to track leveraged positions for each player per game mode, storing position type (long/short), leverage multiplier (2x), entry price, ICP amount, and timestamp",
      "reqIds": [
        "REQ-26"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Implement backend function to open a leveraged long position at 2x leverage, deducting the required margin (position_size / 2) from cash balance and recording the entry price",
      "reqIds": [
        "REQ-27"
      ],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Implement backend function to open a leveraged short position at 2x leverage, deducting the required margin (position_size / 2) from cash balance and recording the entry price",
      "reqIds": [
        "REQ-28"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Implement backend function to close a leveraged position, calculating profit/loss based on entry price vs current price with 2x multiplier, returning margin plus/minus P&L to cash balance",
      "reqIds": [
        "REQ-29"
      ],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Add backend query function to retrieve all active leveraged positions for the authenticated player in the current game mode, including unrealized P&L calculations",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Add support for multiple leverage levels beyond 2x (3x, 5x, 10x, 20x) for long and short positions",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Display margin call statistics on the price chart, showing margin requirements and liquidation levels for active positions",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Replace line chart with candlestick chart visualization showing OHLC (Open, High, Low, Close) data for ICP price movements",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Add support for 3x, 5x, 10x, and 20x leverage multipliers to the backend open_long_position and open_short_position functions, allowing users to select their leverage level when opening positions",
      "reqIds": [
        "REQ-36"
      ],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Replace CoinGecko API with Kong Swap API for ICP price data and candlestick chart visualization",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Update the PriceChart component (frontend/src/components/PriceChart.tsx) to render candlestick data from Kong Swap API instead of CoinGecko, ensuring the chart visualization remains functional with the new data source",
      "reqIds": [
        "REQ-45"
      ],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Update the backend ICP price fetching logic in backend/main.mo to use Kong Swap API instead of CoinGecko for real-time price data used in trading calculations",
      "reqIds": [
        "REQ-46"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Replace candlestick chart with a simple line chart visualization using Kong Swap API data",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-40",
      "summary": "Integrate all available trading tools from Kong Swap API (trading volume, liquidity metrics, order book depth, technical indicators)",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "projectName": "ICP Trading Game",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}